{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport App from \"../API/firebaseConfig\";\nvar SET_AUTH_SUCCESS = \"SET_AUTH_SUCCESS\";\nvar SET_AUTH_LOGOUT = \"SET_AUTH_LOGOUT\";\nexport var MODULE_NAME = \"auth\";\nexport var selectAuthStatus = function selectAuthStatus(state) {\n  return state[MODULE_NAME].status;\n};\nexport var selectAuthUserID = function selectAuthUserID(state) {\n  return state[MODULE_NAME].userID;\n};\nexport var selectAuthUsername = function selectAuthUsername(state) {\n  return state[MODULE_NAME].username;\n};\nvar initialState = {\n  status: false,\n  userID: null,\n  username: null,\n  isAdmin: false\n};\nexport function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n\n  var _ref = arguments.length > 1 ? arguments[1] : undefined,\n      type = _ref.type,\n      payload = _ref.payload;\n\n  switch (type) {\n    case SET_AUTH_SUCCESS:\n      console.log('in reducer');\n      return payload;\n\n    case SET_AUTH_LOGOUT:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        status: false,\n        userID: null,\n        username: null\n      });\n\n    default:\n      return state;\n  }\n}\nexport var setAuthSuccess = function setAuthSuccess(payload) {\n  return {\n    type: SET_AUTH_SUCCESS,\n    payload: payload\n  };\n};\nexport var setAuthLogout = function setAuthLogout() {\n  return {\n    type: SET_AUTH_LOGOUT\n  };\n};\nexport var sign = function sign(email, password, username, isSignIn) {\n  return function _callee(dispatch) {\n    var isAdmin, uid, userRef, admins, _await$App$auth$creat;\n\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            console.log('inside sign method');\n            isAdmin = false;\n            uid = null;\n            _context.prev = 3;\n\n            if (!isSignIn) {\n              _context.next = 15;\n              break;\n            }\n\n            console.log('is sign in');\n            _context.next = 8;\n            return _regeneratorRuntime.awrap(App.auth.signInWithEmailAndPassword(email, password));\n\n          case 8:\n            userRef = _context.sent;\n            uid = userRef.user.uid;\n            console.log('user: ', uid);\n            admins = App.db.ref().child('users').child('admins');\n            admins.once('value').then(function (data) {\n              Object.keys(data.toJSON()).forEach(function (uidAdmin) {\n                if (uidAdmin === uid) {\n                  isAdmin = true;\n                  console.log('match', isAdmin + ' ' + uidAdmin);\n                }\n              });\n            });\n            _context.next = 27;\n            break;\n\n          case 15:\n            _context.prev = 15;\n            console.log('inside signup, email and pass: ', email, password);\n            _context.next = 19;\n            return _regeneratorRuntime.awrap(App.auth.createUserWithEmailAndPassword(email, password));\n\n          case 19:\n            _await$App$auth$creat = _context.sent;\n            uid = _await$App$auth$creat.user.uid;\n            App.db.ref(\"users/\" + uid).set({\n              username: username\n            });\n            _context.next = 27;\n            break;\n\n          case 24:\n            _context.prev = 24;\n            _context.t0 = _context[\"catch\"](15);\n            console.log('catch error:', _context.t0);\n\n          case 27:\n            dispatch(setAuthSuccess({\n              userID: uid,\n              username: username,\n              status: true,\n              isAdmin: isAdmin\n            }));\n            console.log('is admin in end: ', isAdmin);\n            _context.next = 34;\n            break;\n\n          case 31:\n            _context.prev = 31;\n            _context.t1 = _context[\"catch\"](3);\n            console.log(_context.t1.message);\n\n          case 34:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[3, 31], [15, 24]], Promise);\n  };\n};\nexport var logOut = function logOut() {\n  return function _callee2(dispatch) {\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(App.auth.signOut());\n\n          case 3:\n            dispatch(setAuthLogout());\n            _context2.next = 9;\n            break;\n\n          case 6:\n            _context2.prev = 6;\n            _context2.t0 = _context2[\"catch\"](0);\n            Alert.alert(_context2.t0.message);\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 6]], Promise);\n  };\n};","map":{"version":3,"sources":["C:/Users/shohrat.garadaghli/Desktop/dev/orderApp/src/store/Auth.js"],"names":["App","SET_AUTH_SUCCESS","SET_AUTH_LOGOUT","MODULE_NAME","selectAuthStatus","state","status","selectAuthUserID","userID","selectAuthUsername","username","initialState","isAdmin","reducer","type","payload","console","log","setAuthSuccess","setAuthLogout","sign","email","password","isSignIn","dispatch","uid","auth","signInWithEmailAndPassword","userRef","user","admins","db","ref","child","once","then","data","Object","keys","toJSON","forEach","uidAdmin","createUserWithEmailAndPassword","set","message","logOut","signOut","Alert","alert"],"mappings":";;;;;;;;AACA,OAAOA,GAAP;AAGA,IAAMC,gBAAgB,GAAG,kBAAzB;AACA,IAAMC,eAAe,GAAG,iBAAxB;AAIA,OAAO,IAAMC,WAAW,GAAG,MAApB;AACP,OAAO,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,KAAD;AAAA,SAAWA,KAAK,CAACF,WAAD,CAAL,CAAmBG,MAA9B;AAAA,CAAzB;AACP,OAAO,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACF,KAAD;AAAA,SAAWA,KAAK,CAACF,WAAD,CAAL,CAAmBK,MAA9B;AAAA,CAAzB;AACP,OAAO,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAACJ,KAAD;AAAA,SAAWA,KAAK,CAACF,WAAD,CAAL,CAAmBO,QAA9B;AAAA,CAA3B;AAIP,IAAMC,YAAY,GAAG;AACnBL,EAAAA,MAAM,EAAE,KADW;AAEnBE,EAAAA,MAAM,EAAE,IAFW;AAGnBE,EAAAA,QAAQ,EAAE,IAHS;AAInBE,EAAAA,OAAO,EAAC;AAJW,CAArB;AAQA,OAAO,SAASC,OAAT,GAA0D;AAAA,MAAzCR,KAAyC,uEAAjCM,YAAiC;;AAAA;AAAA,MAAjBG,IAAiB,QAAjBA,IAAiB;AAAA,MAAXC,OAAW,QAAXA,OAAW;;AAC/D,UAAQD,IAAR;AACE,SAAKb,gBAAL;AACEe,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,aAAOF,OAAP;;AACF,SAAKb,eAAL;AACE,6CACKG,KADL;AAEEC,QAAAA,MAAM,EAAE,KAFV;AAGEE,QAAAA,MAAM,EAAE,IAHV;AAIEE,QAAAA,QAAQ,EAAE;AAJZ;;AAWF;AACE,aAAOL,KAAP;AAjBJ;AAmBD;AAGD,OAAO,IAAMa,cAAc,GAAG,SAAjBA,cAAiB,CAACH,OAAD;AAAA,SAAc;AAC1CD,IAAAA,IAAI,EAAEb,gBADoC;AAE1Cc,IAAAA,OAAO,EAAPA;AAF0C,GAAd;AAAA,CAAvB;AAQP,OAAO,IAAMI,aAAa,GAAG,SAAhBA,aAAgB;AAAA,SAAO;AAClCL,IAAAA,IAAI,EAAEZ;AAD4B,GAAP;AAAA,CAAtB;AAKP,OAAO,IAAMkB,IAAI,GAAG,SAAPA,IAAO,CAACC,KAAD,EAAQC,QAAR,EAAkBZ,QAAlB,EAA4Ba,QAA5B;AAAA,SAAyC,iBAC3DC,QAD2D;AAAA;;AAAA;AAAA;AAAA;AAAA;AAGzDR,YAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ;AACIL,YAAAA,OAJqD,GAI7C,KAJ6C;AAKrDa,YAAAA,GALqD,GAKjD,IALiD;AAAA;;AAAA,iBAQrDF,QARqD;AAAA;AAAA;AAAA;;AASvDP,YAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AATuD;AAAA,6CAUnCjB,GAAG,CAAC0B,IAAJ,CAASC,0BAAT,CAAoCN,KAApC,EAA2CC,QAA3C,CAVmC;;AAAA;AAUjDM,YAAAA,OAViD;AAWvDH,YAAAA,GAAG,GAACG,OAAO,CAACC,IAAR,CAAaJ,GAAjB;AACAT,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAqBQ,GAArB;AACIK,YAAAA,MAbmD,GAa1C9B,GAAG,CAAC+B,EAAJ,CAAOC,GAAP,GAAaC,KAAb,CAAmB,OAAnB,EAA4BA,KAA5B,CAAkC,QAAlC,CAb0C;AAcvDH,YAAAA,MAAM,CAACI,IAAP,CAAY,OAAZ,EAAqBC,IAArB,CACE,UAACC,IAAD,EAAQ;AACNC,cAAAA,MAAM,CAACC,IAAP,CAAYF,IAAI,CAACG,MAAL,EAAZ,EAA2BC,OAA3B,CAAmC,UAAAC,QAAQ,EAAE;AAC3C,oBAAIA,QAAQ,KAAGhB,GAAf,EAAmB;AACjBb,kBAAAA,OAAO,GAAC,IAAR;AACAI,kBAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAoBL,OAAO,GAAE,GAAT,GAAa6B,QAAjC;AACD;AACF,eALD;AAMD,aARH;AAduD;AAAA;;AAAA;AAAA;AA2BjDzB,YAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ,EAA8CI,KAA9C,EAAoDC,QAApD;AA3BiD;AAAA,6CA8BvCtB,GAAG,CAAC0B,IAAJ,CAASgB,8BAAT,CAAwCrB,KAAxC,EAA+CC,QAA/C,CA9BuC;;AAAA;AAAA;AA6BvCG,YAAAA,GA7BuC,yBA6B/CI,IA7B+C,CA6BvCJ,GA7BuC;AAiCjDzB,YAAAA,GAAG,CAAC+B,EAAJ,CAAOC,GAAP,YAAoBP,GAApB,EAA2BkB,GAA3B,CAA+B;AAAEjC,cAAAA,QAAQ,EAARA;AAAF,aAA/B;AAjCiD;AAAA;;AAAA;AAAA;AAAA;AAmCjDM,YAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;;AAnCiD;AAwCzDO,YAAAA,QAAQ,CACNN,cAAc,CAAC;AACbV,cAAAA,MAAM,EAAEiB,GADK;AAEbf,cAAAA,QAAQ,EAARA,QAFa;AAGbJ,cAAAA,MAAM,EAAE,IAHK;AAIbM,cAAAA,OAAO,EAACA;AAJK,aAAD,CADR,CAAR;AASAI,YAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAgCL,OAAhC;AAjDyD;AAAA;;AAAA;AAAA;AAAA;AAmDzDI,YAAAA,OAAO,CAACC,GAAR,CAAY,YAAM2B,OAAlB;;AAnDyD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAzC;AAAA,CAAb;AAuDP,OAAO,IAAMC,MAAM,GAAG,SAATA,MAAS;AAAA,SAAM,kBAAOrB,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAElBxB,GAAG,CAAC0B,IAAJ,CAASoB,OAAT,EAFkB;;AAAA;AAGxBtB,YAAAA,QAAQ,CAACL,aAAa,EAAd,CAAR;AAHwB;AAAA;;AAAA;AAAA;AAAA;AAKxB4B,YAAAA,KAAK,CAACC,KAAN,CAAY,aAAMJ,OAAlB;;AALwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAN;AAAA,CAAf","sourcesContent":["import { Alert } from \"react-native\";\r\nimport App from \"../API/firebaseConfig\";\r\n\r\n// ACTION TYPES\r\nconst SET_AUTH_SUCCESS = \"SET_AUTH_SUCCESS\";\r\nconst SET_AUTH_LOGOUT = \"SET_AUTH_LOGOUT\";\r\n/*const SET_AUTH_PHOTO = \"SET_AUTH_PHOTO\";*/\r\n\r\n// SELECTORS\r\nexport const MODULE_NAME = \"auth\";\r\nexport const selectAuthStatus = (state) => state[MODULE_NAME].status;\r\nexport const selectAuthUserID = (state) => state[MODULE_NAME].userID;\r\nexport const selectAuthUsername = (state) => state[MODULE_NAME].username;\r\n/*export const selectAuthPhoto = (state) => state[MODULE_NAME].photo;*/\r\n\r\n// REDUCER\r\nconst initialState = {\r\n  status: false,\r\n  userID: null,\r\n  username: null,\r\n  isAdmin:false\r\n  /*photo: null,*/\r\n};\r\n\r\nexport function reducer(state = initialState, { type, payload }) {\r\n  switch (type) {\r\n    case SET_AUTH_SUCCESS:\r\n      console.log('in reducer');\r\n      return payload\r\n    case SET_AUTH_LOGOUT:\r\n      return {\r\n        ...state,\r\n        status: false,\r\n        userID: null,\r\n        username: null,\r\n      };\r\n    /*case SET_AUTH_PHOTO:\r\n      return {\r\n        ...state,\r\n        photo: payload,\r\n      };*/\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\n// ACTION CREATORS\r\nexport const setAuthSuccess = (payload) => ({\r\n  type: SET_AUTH_SUCCESS,\r\n  payload,\r\n});\r\n/*export const setAuthPhoto = (payload) => ({\r\n  type: SET_AUTH_PHOTO,\r\n  payload,\r\n});*/\r\nexport const setAuthLogout = () => ({\r\n  type: SET_AUTH_LOGOUT,\r\n});\r\n\r\n// MIDDLEWARES\r\nexport const sign = (email, password, username, isSignIn) => async (\r\n  dispatch\r\n) => {\r\n    console.log('inside sign method');\r\n    var isAdmin=false;\r\n    let uid=null;\r\n  try {\r\n    \r\n    if (isSignIn) { \r\n      console.log('is sign in');\r\n      const userRef=await App.auth.signInWithEmailAndPassword(email, password);\r\n      uid=userRef.user.uid;\r\n      console.log('user: ',uid)\r\n      var admins = App.db.ref().child('users').child('admins');\r\n      admins.once('value').then(\r\n        (data)=>{\r\n          Object.keys(data.toJSON()).forEach(uidAdmin=>{\r\n            if (uidAdmin===uid){\r\n              isAdmin=true;\r\n              console.log('match',isAdmin+ ' '+uidAdmin);\r\n            }\r\n          })\r\n        }\r\n      )\r\n      \r\n    } else {\r\n        try {\r\n            console.log('inside signup, email and pass: ',email,password);\r\n            ({\r\n              user: { uid },\r\n            } = await App.auth.createUserWithEmailAndPassword(email, password));\r\n            //const {user} = await App.auth.createUserWithEmailAndPassword(email, password);\r\n            \r\n            App.db.ref(`users/${uid}`).set({ username /*, photo: \"\" */});\r\n        } catch (error) {\r\n            console.log('catch error:',error);\r\n        }\r\n\r\n    }\r\n\r\n    dispatch(\r\n      setAuthSuccess({\r\n        userID: uid,\r\n        username,\r\n        status: true,\r\n        isAdmin:isAdmin\r\n        /*photo,*/\r\n      })\r\n    );\r\n    console.log('is admin in end: ',isAdmin)\r\n  } catch (error) {\r\n    console.log(error.message);\r\n  }\r\n};\r\n\r\nexport const logOut = () => async (dispatch) => {\r\n  try {\r\n    await App.auth.signOut();\r\n    dispatch(setAuthLogout());\r\n  } catch (error) {\r\n    Alert.alert(error.message);\r\n  }\r\n};\r\n\r\n"]},"metadata":{},"sourceType":"module"}