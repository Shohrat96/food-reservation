{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport App from \"../API/firebaseConfig\";\nvar SET_AUTH_SUCCESS = \"SET_AUTH_SUCCESS\";\nvar SET_AUTH_LOGOUT = \"SET_AUTH_LOGOUT\";\nexport var MODULE_NAME = \"auth\";\nexport var selectAuthStatus = function selectAuthStatus(state) {\n  return state[MODULE_NAME].status;\n};\nexport var selectAuthUserID = function selectAuthUserID(state) {\n  return state[MODULE_NAME].userID;\n};\nexport var selectAuthUsername = function selectAuthUsername(state) {\n  return state[MODULE_NAME].username;\n};\nvar initialState = {\n  status: false,\n  userID: null,\n  username: null,\n  isAdmin: false\n};\nexport function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n\n  var _ref = arguments.length > 1 ? arguments[1] : undefined,\n      type = _ref.type,\n      payload = _ref.payload;\n\n  switch (type) {\n    case SET_AUTH_SUCCESS:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        status: true,\n        userID: payload.userID,\n        username: payload.username\n      });\n\n    case SET_AUTH_LOGOUT:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        status: false,\n        userID: null,\n        username: null\n      });\n\n    default:\n      return state;\n  }\n}\nexport var setAuthSuccess = function setAuthSuccess(payload) {\n  return {\n    type: SET_AUTH_SUCCESS,\n    payload: payload\n  };\n};\nexport var setAuthLogout = function setAuthLogout() {\n  return {\n    type: SET_AUTH_LOGOUT\n  };\n};\nexport var sign = function sign(email, password, username, isSignIn) {\n  return function _callee(dispatch) {\n    var userRef, _uid, users, userDataSnapshot, leadsRef, _await$App$auth$creat;\n\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            console.log('inside sign method');\n            _context.prev = 1;\n\n            if (!isSignIn) {\n              _context.next = 20;\n              break;\n            }\n\n            console.log('is sign in');\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(App.auth.signInWithEmailAndPassword(email, password));\n\n          case 6:\n            userRef = _context.sent;\n            _uid = userRef.user.uid;\n            console.log('user: ', _uid);\n            users = App.db.ref().child('users');\n            users.once('value').then(function (data) {\n              return console.log('data: ', data.toJSON());\n            });\n            _context.next = 13;\n            return _regeneratorRuntime.awrap(App.db.ref(\"users/admins\"));\n\n          case 13:\n            userDataSnapshot = _context.sent;\n            leadsRef = App.db.ref('users/admins');\n            console.log('admins in ref: ', leadsRef.val());\n            leadsRef.on('value', function (snapshot) {\n              console.log('snapshot username:');\n              snapshot.forEach(function (childSnapshot) {\n                var childData = childSnapshot.val();\n                console.log('child data: ', childData);\n              });\n            });\n            console.log('username: ', userDataSnapshot);\n            _context.next = 32;\n            break;\n\n          case 20:\n            _context.prev = 20;\n            console.log('inside signup, email and pass: ', email, password);\n            _context.next = 24;\n            return _regeneratorRuntime.awrap(App.auth.createUserWithEmailAndPassword(email, password));\n\n          case 24:\n            _await$App$auth$creat = _context.sent;\n            uid = _await$App$auth$creat.user.uid;\n            App.db.ref(\"users/\" + uid).set({\n              username: username\n            });\n            _context.next = 32;\n            break;\n\n          case 29:\n            _context.prev = 29;\n            _context.t0 = _context[\"catch\"](20);\n            console.log('catch error:', _context.t0);\n\n          case 32:\n            dispatch(setAuthSuccess({\n              userID: uid,\n              username: username,\n              status: true\n            }));\n            _context.next = 38;\n            break;\n\n          case 35:\n            _context.prev = 35;\n            _context.t1 = _context[\"catch\"](1);\n            Alert.alert(_context.t1.message);\n\n          case 38:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[1, 35], [20, 29]], Promise);\n  };\n};\nexport var logOut = function logOut() {\n  return function _callee2(dispatch) {\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(App.auth.signOut());\n\n          case 3:\n            dispatch(setAuthLogout());\n            _context2.next = 9;\n            break;\n\n          case 6:\n            _context2.prev = 6;\n            _context2.t0 = _context2[\"catch\"](0);\n            Alert.alert(_context2.t0.message);\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 6]], Promise);\n  };\n};","map":{"version":3,"sources":["C:/Users/shohrat.garadaghli/Desktop/dev/orderApp/src/store/Auth.js"],"names":["App","SET_AUTH_SUCCESS","SET_AUTH_LOGOUT","MODULE_NAME","selectAuthStatus","state","status","selectAuthUserID","userID","selectAuthUsername","username","initialState","isAdmin","reducer","type","payload","setAuthSuccess","setAuthLogout","sign","email","password","isSignIn","dispatch","console","log","auth","signInWithEmailAndPassword","userRef","uid","user","users","db","ref","child","once","then","data","toJSON","userDataSnapshot","leadsRef","val","on","snapshot","forEach","childSnapshot","childData","createUserWithEmailAndPassword","set","Alert","alert","message","logOut","signOut"],"mappings":"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","sourcesContent":["import { Alert } from \"react-native\";\r\nimport App from \"../API/firebaseConfig\";\r\n\r\n// ACTION TYPES\r\nconst SET_AUTH_SUCCESS = \"SET_AUTH_SUCCESS\";\r\nconst SET_AUTH_LOGOUT = \"SET_AUTH_LOGOUT\";\r\n/*const SET_AUTH_PHOTO = \"SET_AUTH_PHOTO\";*/\r\n\r\n// SELECTORS\r\nexport const MODULE_NAME = \"auth\";\r\nexport const selectAuthStatus = (state) => state[MODULE_NAME].status;\r\nexport const selectAuthUserID = (state) => state[MODULE_NAME].userID;\r\nexport const selectAuthUsername = (state) => state[MODULE_NAME].username;\r\n/*export const selectAuthPhoto = (state) => state[MODULE_NAME].photo;*/\r\n\r\n// REDUCER\r\nconst initialState = {\r\n  status: false,\r\n  userID: null,\r\n  username: null,\r\n  isAdmin:false\r\n  /*photo: null,*/\r\n};\r\n\r\nexport function reducer(state = initialState, { type, payload }) {\r\n  switch (type) {\r\n    case SET_AUTH_SUCCESS:\r\n      return {\r\n        ...state,\r\n        status: true,\r\n        userID: payload.userID,\r\n        username: payload.username,\r\n        /*photo: payload.photo,*/\r\n      };\r\n    case SET_AUTH_LOGOUT:\r\n      return {\r\n        ...state,\r\n        status: false,\r\n        userID: null,\r\n        username: null,\r\n      };\r\n    /*case SET_AUTH_PHOTO:\r\n      return {\r\n        ...state,\r\n        photo: payload,\r\n      };*/\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\n// ACTION CREATORS\r\nexport const setAuthSuccess = (payload) => ({\r\n  type: SET_AUTH_SUCCESS,\r\n  payload,\r\n});\r\n/*export const setAuthPhoto = (payload) => ({\r\n  type: SET_AUTH_PHOTO,\r\n  payload,\r\n});*/\r\nexport const setAuthLogout = () => ({\r\n  type: SET_AUTH_LOGOUT,\r\n});\r\n\r\n// MIDDLEWARES\r\nexport const sign = (email, password, username, isSignIn) => async (\r\n  dispatch\r\n) => {\r\n    console.log('inside sign method');\r\n  try {\r\n    \r\n    if (isSignIn) { \r\n      console.log('is sign in');\r\n      const userRef=await App.auth.signInWithEmailAndPassword(email, password);\r\n      const {uid}=userRef.user;\r\n      console.log('user: ',uid)\r\n      var users = App.db.ref().child('users');\r\n      users.once('value').then(\r\n        (data)=>console.log('data: ',data.toJSON())\r\n      )\r\n      const userDataSnapshot = await App.db.ref(`users/admins`);\r\n\r\n      var leadsRef = App.db.ref('users/admins');\r\n      console.log('admins in ref: ',leadsRef.val());\r\n      leadsRef.on('value', function(snapshot) {\r\n        console.log('snapshot username:')\r\n          snapshot.forEach(function(childSnapshot) {\r\n            let childData = childSnapshot.val();\r\n            console.log('child data: ',childData);\r\n          });\r\n      });\r\n      console.log('username: ',userDataSnapshot);\r\n    } else {\r\n        try {\r\n            console.log('inside signup, email and pass: ',email,password);\r\n            ({\r\n              user: { uid },\r\n            } = await App.auth.createUserWithEmailAndPassword(email, password));\r\n            //const {user} = await App.auth.createUserWithEmailAndPassword(email, password);\r\n            \r\n            App.db.ref(`users/${uid}`).set({ username /*, photo: \"\" */});\r\n        } catch (error) {\r\n            console.log('catch error:',error);\r\n        }\r\n\r\n    }\r\n\r\n    dispatch(\r\n      setAuthSuccess({\r\n        userID: uid,\r\n        username,\r\n        status: true,\r\n        /*photo,*/\r\n      })\r\n    );\r\n  } catch (error) {\r\n    Alert.alert(error.message);\r\n  }\r\n};\r\n\r\nexport const logOut = () => async (dispatch) => {\r\n  try {\r\n    await App.auth.signOut();\r\n    dispatch(setAuthLogout());\r\n  } catch (error) {\r\n    Alert.alert(error.message);\r\n  }\r\n};\r\n\r\n"]},"metadata":{},"sourceType":"module"}